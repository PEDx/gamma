## Gamma

`Web 低代码编辑器`

### 设计初步

0. 项目

- 编辑器以项目为单位，项目包含一个页面或多个页面

1. 数据

- 由编辑器产生的编辑数据分为结构数据和配置数据
- 页面的数据来源有编辑器提供的结构数据和配置数据，以及接口提供的接口数据
- 结构数据就是编辑时插入的各个 dom 结构构成的结构树
- 配置数据就是拖拽及配置产生的数据，每个数据节点对应一个结构节点
- 理想情况下，业务接口数据可以映射到页面的各个组件数据接口里
- 基于以上特点，发布页面拥有运行时，主要是插入结构数据，对每个结构节点赋予配置数据，执行代码组
  件

2. 组件

- 基础组件分为：空组件、文字组件、图片组件、按钮组件等
- 容器组件分为：列表容器、tab 容器、布局组件、页面组件等
- 业务组件：自定义的业务组件，表现为接口请求列表，触发接口请求等
- 业务组件本质是业务的复用，业务是多变的，因此单独为一个类型。
- 组件的配置项，来源可能是编辑器配置，也可能是接口
- 基础组件一般被置于整个树形结构的叶节点处，容器组件一般为有特殊功能容器
- 容器组件和业务组件保留可往组件内部添加组件的能力
- 组件支持跨页面复制。
- 组件支持调整 z-index 层级

3. 代码

- 引入代码来增加灵活性，页面可又编辑器端添加脚本代码
- 在合法引入的脚本代码中可以获取各个组件及编辑数据
- VSCode 代码编辑与浏览器中编辑器的结合是个问题，还需要研究

4. 页面

- 页面模板，包括常规流式布局、一屏滚动布局、 固定底栏布局、固定顶栏布局、三段式布局。
- 页面的生命周期可在代码中触发。
- 支持页面的整体复制。

5. 编辑器

- 支持历史和回退前进功能
- 按键与功能对应
- 支持不同模式，即页面模式和挂件模式
- 支持展示页面组件树
- 单个项目中可包含多个页面、挂件，且图片等资源以项目为单位
- 实现组件边缘吸附，以及相互吸附

6. 配置器

- 支持基于拖拽的编辑模式，基于拖拽可以改变组件大小和位置、旋转角度。
- 支持包括数字、文字、富文本、颜色、渐变颜色的基础配置器
- 支持包括位置配置、大小配置、内外边距
- 业务组件支持插入自定义配置器
- 配置分为数据配置、样式配置，样式配置又分有无单位
- 理论上可以支持单位转换

7. 运行时

- 因为要支持 React 和 Vue 组件，因此除了原始的数据配置运行时，还需要引入组件库本身的运行时

8. 多分辨率适配

- 简单方案：基于 活动模板现行的方案，固定 meta 中 viewport 宽度（375px）
- 复杂方案: 在运行时中，基于当前设备分辨率，基于换算动态生成各个组件中的数值

9. 管理服务

- 后端服务主要提供项目的管理、页面数据的存储和分发

10. 构建服务

- 具体到项目的构建部署，不涉及配置数据接口分发，最终产物是静态文件，保证可用性。
- 具体到构建产物，配置数据和结构数据都会被写到 HTML 文件中
- 支持 React 组件和 Vue 组件的构建

### 配置流程

```
┌───────────────────┐  ┌────────────────┐
│      ViewData     │  │  EditableBox   │
│     -Class        │  │ -Component     │
│ ┌───────────────┐ │  └───┬─────────▲──┘
│ │   meta data   │ │      │         │
│ └───────────────┘ │   SetData    Notify
│                   │      │         │
│ ┌──────────────┬┐ │  ┌───▼─────────┴──┐  Effect    ┌───────────────┐
│ │ configurator │┼─┼──┤  Configurator  ├────────────►   Widget      │
│ └──────────────┴┘ │  │ -Class         │ or Notify  │  -Component   │
│                   │  └───▲─────────┬──┘            ├───────────────┤
│ ┌───────────────┐ │      │         │               │   ViewData    │
│ │ configurator  │ │   SetData   Notify             └──────┬────────┘
│ └───────────────┘ │      │         │                      │
│                   │  ┌───┴─────────▼──┐                   │
│  ...              │  │  Configurator  │                   │
│                   │  │ -Component     │                   │
└─────────┬─────────┘  └────────────────┘                   │
          │                                                 │
          └─────────────────────────────────────────────────┘
```

### 组件需求

#### 0、 基础

- 需求：被拖拽进入编辑界面的组件，可以被拖拽编辑组件的大小、位置。拖拽编辑可由组件配置关闭拖拽
  的某些功能。为了保持简单，组件在编辑界面实例化后，不支持拖拽改变组件的父容器。可在组件树界面改变组件的容器。

#### 1、 用户信息组件

- 展示：展示头像及用户名和扩展文字
- 类型：业务组件
- 数据接口：头像图片地址、用户名文字、扩展文字
- 编辑配置：位置、大小、文字、图片
- 需求：用户信息展示是一个常见需求，主要构成为用户头像，用户名，及分数。在不同的页面中，可能变动
  项头像和文字的位置关系、大小、文字颜色、文字粗细、文字长短、文字的类型、图片边框、图片边框颜色。
  组件可能单独出现（如展示活动参与者），也可能出现在列表中（如排名列表），也有可能以成对的形式出现在列表中（CP 排名列表）。
  数据接口可能是接口获取也可能由编辑器配置产生。
- 设计：基于以上需求，用户信息组件可编辑的范围除了组件本身，在组件内部的图片、文字等都需要能编辑。
  组件需要锁定功能，及锁定后组件内部无法被编辑，只能改变组件的位置。
- 开发：如果由开发人员新建代码项目开发，代码项目与编辑器的融合是个问题。如果由编辑器编辑产出，
  编辑器需要一个业务组件编辑模式，专门产出业务组件。产出流程包括一个业务组件的：展示需求的编辑，脚本代码编辑，
  数据接口的定义。还有对业务组件的包装，发布流程等。

#### 2、 文字组件

- 展示：文字
- 类型：基础组件
- 数据接口：展示的文字
- 编辑配置：位置、大小、文字偏移、颜色、大小、类型、粗细、文字省略。
- 需求：文字组件是基础组件，需要满足（CSS）文字的各项配置。
- 设计：满足配置需求
- 开发：由编辑器提供

#### 3、 tab 容器组件

- 展示：文字
- 类型：容器组件
- 数据接口：无
- 编辑配置： 位置、大小、tab 按钮的大小、文字配置、个数
- 需求：容器组件最主要的功能是对内部组件的位置分发和数据分发，及本身的样式配置
- 设计：满足配置需求
- 开发：由编辑器提供
